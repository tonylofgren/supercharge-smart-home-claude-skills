# ESPHome Code Assistant - Usage Guide

Complete guide with 50+ usage examples organized by skill level. Learn how to get the most out of this skill.

## Table of Contents

- [How It Works](#how-it-works)
- [Beginner Examples](#beginner-examples)
- [Intermediate Examples](#intermediate-examples)
- [Advanced Examples](#advanced-examples)
- [Troubleshooting Examples](#troubleshooting-examples)
- [Tips and Tricks](#tips-and-tricks)

---

## How It Works

### Basic Interaction Pattern

1. **Describe what you want** in natural language
2. **Claude generates** complete, working YAML configs
3. **Copy to ESPHome** dashboard and flash

### Example Conversation

**You:** Create an ESP32 with a DHT22 temperature and humidity sensor on GPIO4

**Claude:** Here's a complete ESPHome configuration:

```yaml
# Generated by supercharge-esphome-skill v1.0.0
# https://github.com/tonylofgren/supercharge-smart-home-claude-skills

esphome:
  name: temperature-sensor
  friendly_name: Temperature Sensor

esp32:
  board: esp32dev

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

api:
  encryption:
    key: !secret api_key

ota:
  platform: esphome
  password: !secret ota_password

logger:

sensor:
  - platform: dht
    pin: GPIO4
    model: DHT22
    temperature:
      name: "Temperature"
    humidity:
      name: "Humidity"
    update_interval: 30s
```

---

## Beginner Examples

### 1. First Sensor Device

**You:** Create my first ESPHome device - an ESP32 that monitors room temperature

**What you get:**
- Complete working config
- WiFi setup with secrets
- Home Assistant API integration
- OTA updates enabled
- DHT or Dallas temperature sensor

---

### 2. Simple On/Off Switch

**You:** Add a relay switch on GPIO12 that I can control from Home Assistant

**What you get:**
```yaml
switch:
  - platform: gpio
    pin: GPIO12
    name: "Relay"
    id: relay_switch
    restore_mode: RESTORE_DEFAULT_OFF
```

---

### 3. Button Input

**You:** Add a physical button on GPIO5 that toggles the relay when pressed

**What you get:**
```yaml
binary_sensor:
  - platform: gpio
    pin:
      number: GPIO5
      mode: INPUT_PULLUP
      inverted: true
    name: "Button"
    on_press:
      - switch.toggle: relay_switch
```

---

### 4. Status LED

**You:** Add a status LED on GPIO2 that shows when the device is connected

**What you get:**
```yaml
status_led:
  pin: GPIO2

# Or for more control:
light:
  - platform: status_led
    name: "Status LED"
    pin: GPIO2
```

---

### 5. WiFi Signal Monitoring

**You:** Show me how to monitor WiFi signal strength

**What you get:**
```yaml
sensor:
  - platform: wifi_signal
    name: "WiFi Signal"
    update_interval: 60s
    entity_category: diagnostic
```

---

### 6. Device Uptime

**You:** Track how long the device has been running

**What you get:**
```yaml
sensor:
  - platform: uptime
    name: "Uptime"
    entity_category: diagnostic
```

---

### 7. Restart Button

**You:** Add a button in Home Assistant to restart the ESP device

**What you get:**
```yaml
button:
  - platform: restart
    name: "Restart"
    entity_category: config
```

---

### 8. Simple Light Control

**You:** Control an LED on GPIO13 with dimming

**What you get:**
```yaml
output:
  - platform: ledc
    pin: GPIO13
    id: led_output

light:
  - platform: monochromatic
    name: "LED"
    output: led_output
```

---

### 9. Door/Window Sensor

**You:** Create a door sensor using a reed switch on GPIO14

**What you get:**
```yaml
binary_sensor:
  - platform: gpio
    pin:
      number: GPIO14
      mode: INPUT_PULLUP
    name: "Door"
    device_class: door
    filters:
      - delayed_on: 100ms
      - delayed_off: 100ms
```

---

### 10. Motion Sensor (PIR)

**You:** Add a PIR motion sensor on GPIO27

**What you get:**
```yaml
binary_sensor:
  - platform: gpio
    pin: GPIO27
    name: "Motion"
    device_class: motion
    filters:
      - delayed_off: 30s  # Keep motion active for 30s after last trigger
```

---

## Intermediate Examples

### 11. Multiple Sensors Combo

**You:** Create a multi-sensor with temperature, humidity, pressure, and light level

**What you get:**
- BME280 for temp/humidity/pressure
- BH1750 for light level
- Proper I2C bus configuration
- All sensors with appropriate update intervals

---

### 12. RGB LED Strip

**You:** Add a WS2812 LED strip with 60 LEDs on GPIO25

**What you get:**
```yaml
light:
  - platform: esp32_rmt_led_strip
    pin: GPIO25
    num_leds: 60
    rmt_channel: 0
    chipset: WS2812
    rgb_order: GRB
    name: "LED Strip"
    effects:
      - rainbow:
      - pulse:
      - strobe:
      - color_wipe:
```

---

### 13. Energy Monitoring

**You:** Add power monitoring using a CT clamp and SCT-013-030

**What you get:**
```yaml
sensor:
  - platform: ct_clamp
    sensor: adc_sensor
    name: "Power"
    sample_duration: 200ms
    update_interval: 5s
    filters:
      - calibrate_linear:
          - 0 -> 0
          - 0.02 -> 30  # 30A CT at 30A = 1V, ADC reads 0.02
    unit_of_measurement: "A"

  - platform: adc
    pin: GPIO34
    id: adc_sensor
    attenuation: 11db
```

---

### 14. OLED Display

**You:** Add an SSD1306 OLED display showing temperature and time

**What you get:**
```yaml
i2c:
  sda: GPIO21
  scl: GPIO22

display:
  - platform: ssd1306_i2c
    model: "SSD1306 128x64"
    address: 0x3C
    lambda: |-
      it.printf(0, 0, id(font1), "Temp: %.1f°C", id(temperature).state);
      it.strftime(0, 20, id(font1), "%H:%M", id(sntp_time).now());

font:
  - file: "gfonts://Roboto"
    id: font1
    size: 16

time:
  - platform: sntp
    id: sntp_time
```

---

### 15. Thermostat Control

**You:** Create a thermostat that controls a heater relay based on temperature

**What you get:**
```yaml
climate:
  - platform: thermostat
    name: "Thermostat"
    sensor: temperature_sensor
    default_preset: Home
    preset:
      - name: Home
        default_target_temperature_low: 20°C
      - name: Away
        default_target_temperature_low: 16°C
    heat_action:
      - switch.turn_on: heater_relay
    idle_action:
      - switch.turn_off: heater_relay
    heat_deadband: 0.5°C
    heat_overrun: 0.5°C
```

---

### 16. Garage Door Controller

**You:** Create a garage door controller with position sensing and safety features

**What you get:**
- Cover component with open/close/stop
- Reed switches for open/closed detection
- Obstruction sensor input
- Relay control with timing
- Safety lockout when obstructed

---

### 17. IR Remote Hub

**You:** Create an IR transmitter to control my Samsung TV

**What you get:**
```yaml
remote_transmitter:
  pin: GPIO4
  carrier_duty_percent: 50%

button:
  - platform: template
    name: "TV Power"
    on_press:
      - remote_transmitter.transmit_samsung:
          data: 0xE0E040BF  # Samsung power code

  - platform: template
    name: "TV Volume Up"
    on_press:
      - remote_transmitter.transmit_samsung:
          data: 0xE0E0E01F
```

---

### 18. Pulse Counter (Water Meter)

**You:** Monitor water usage with a pulse meter

**What you get:**
```yaml
sensor:
  - platform: pulse_meter
    pin: GPIO5
    name: "Water Flow"
    unit_of_measurement: "L/min"
    filters:
      - multiply: 0.5  # Adjust for your meter's pulses per liter
    total:
      name: "Total Water"
      unit_of_measurement: "L"
      accuracy_decimals: 0
```

---

### 19. Shelly 1PM Conversion

**You:** Convert my Shelly 1PM to ESPHome

**What you get:**
- Correct GPIO mappings for Shelly 1PM
- HLW8012 power monitoring
- Button input
- Relay output
- Temperature monitoring
- LED status

---

### 20. Sonoff Basic Conversion

**You:** Flash my Sonoff Basic with ESPHome

**What you get:**
- ESP8266 configuration
- Correct GPIO for relay (GPIO12)
- Button on GPIO0
- LED on GPIO13
- Safe mode recovery

---

### 21. Stepper Motor Control

**You:** Control a stepper motor for blinds

**What you get:**
```yaml
stepper:
  - platform: a4988
    id: blind_stepper
    step_pin: GPIO16
    dir_pin: GPIO17
    max_speed: 500 steps/s
    acceleration: 200 steps/s^2

cover:
  - platform: template
    name: "Blinds"
    open_action:
      - stepper.set_target:
          id: blind_stepper
          target: 2000
    close_action:
      - stepper.set_target:
          id: blind_stepper
          target: 0
```

---

### 22. PWM Fan Control

**You:** Create a PWM fan controller with speed levels

**What you get:**
```yaml
output:
  - platform: ledc
    pin: GPIO25
    id: fan_output
    frequency: 25000Hz

fan:
  - platform: speed
    output: fan_output
    name: "Fan"
    speed_count: 10
```

---

### 23. Capacitive Touch Buttons

**You:** Add touch buttons using ESP32 touch pins

**What you get:**
```yaml
esp32_touch:
  setup_mode: false

binary_sensor:
  - platform: esp32_touch
    name: "Touch Button 1"
    pin: GPIO4
    threshold: 1000
    on_press:
      - light.toggle: led

  - platform: esp32_touch
    name: "Touch Button 2"
    pin: GPIO15
    threshold: 1000
```

---

### 24. Time-Based Automation

**You:** Turn on lights at sunset and off at 11 PM

**What you get:**
```yaml
sun:
  latitude: 59.3293°
  longitude: 18.0686°

time:
  - platform: sntp
    id: sntp_time
    on_time:
      - seconds: 0
        minutes: 0
        hours: 23
        then:
          - light.turn_off: outdoor_light

    on_time_sync:
      then:
        - logger.log: "Time synchronized"

interval:
  - interval: 1min
    then:
      - if:
          condition:
            sun.is_below_horizon:
          then:
            - light.turn_on: outdoor_light
```

---

### 25. MQTT Integration

**You:** Use MQTT instead of Home Assistant API

**What you get:**
```yaml
mqtt:
  broker: 192.168.1.100
  username: !secret mqtt_user
  password: !secret mqtt_password
  discovery: true
  topic_prefix: esphome/device_name

sensor:
  - platform: dht
    pin: GPIO4
    temperature:
      name: "Temperature"
      state_topic: esphome/device_name/temperature/state
    humidity:
      name: "Humidity"
```

---

## Advanced Examples

### 26. Victron MPPT Monitoring

**You:** Monitor my Victron SmartSolar MPPT via VE.Direct

**What you get:**
- External component configuration
- UART setup for VE.Direct
- All available sensors (PV voltage, power, battery, yield)
- Charging state text sensor

---

### 27. JK-BMS Battery Monitoring

**You:** Monitor my JK-BMS via Bluetooth

**What you get:**
```yaml
external_components:
  - source: github://syssi/esphome-jk-bms@main
    components: [jk_bms_ble]

esp32_ble_tracker:

jk_bms_ble:
  - id: jk_bms
    mac_address: "C8:47:8C:XX:XX:XX"

sensor:
  - platform: jk_bms_ble
    jk_bms_ble_id: jk_bms
    total_voltage:
      name: "Battery Voltage"
    current:
      name: "Battery Current"
    power:
      name: "Battery Power"
    state_of_charge:
      name: "State of Charge"
    cell_voltage_1:
      name: "Cell 1"
    # ... all cells
```

---

### 28. Voice Assistant

**You:** Create a voice assistant with wake word detection

**What you get:**
- ESP32-S3 with PSRAM configuration
- I2S microphone setup
- Speaker output
- Wake word engine
- Home Assistant voice pipeline integration

---

### 29. BLE Presence Detection

**You:** Create a Bluetooth presence detector for room occupancy

**What you get:**
```yaml
esp32_ble_tracker:
  scan_parameters:
    interval: 1100ms
    window: 1100ms
    active: true

binary_sensor:
  - platform: ble_presence
    mac_address: "XX:XX:XX:XX:XX:XX"
    name: "Phone Present"
    device_class: presence

  - platform: ble_presence
    ibeacon_uuid: "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
    name: "iBeacon Present"
```

---

### 30. Deep Sleep for Battery

**You:** Optimize my sensor for battery operation with deep sleep

**What you get:**
```yaml
deep_sleep:
  run_duration: 30s
  sleep_duration: 5min
  wakeup_pin: GPIO33
  wakeup_pin_mode: INVERT_WAKEUP

sensor:
  - platform: adc
    pin: GPIO34
    name: "Battery Voltage"
    attenuation: 11db
    filters:
      - multiply: 2  # Voltage divider factor
    on_value_range:
      - below: 3.3
        then:
          - deep_sleep.prevent: deep_sleep_1
          - logger.log: "Battery low, preventing sleep for charging"
```

---

### 31. PID Climate Control

**You:** Create a thermostat with PID control for precise temperature

**What you get:**
```yaml
climate:
  - platform: pid
    name: "PID Thermostat"
    sensor: temperature_sensor
    default_target_temperature: 21°C
    heat_output: heater_output
    control_parameters:
      kp: 0.5
      ki: 0.01
      kd: 0.1
      output_averaging_samples: 5
      derivative_averaging_samples: 5
```

---

### 32. E-Paper Display Dashboard

**You:** Create a low-power e-paper dashboard for weather and sensors

**What you get:**
- Waveshare e-paper configuration
- Deep sleep between updates
- Home Assistant data fetching
- Multi-page layout
- Battery monitoring

---

### 33. CAN Bus Integration

**You:** Read data from a vehicle CAN bus

**What you get:**
```yaml
canbus:
  - platform: esp32_can
    tx_pin: GPIO21
    rx_pin: GPIO22
    can_id: 0x100
    bit_rate: 500kbps

sensor:
  - platform: template
    name: "Vehicle Speed"
    id: vehicle_speed
    unit_of_measurement: "km/h"

interval:
  - interval: 100ms
    then:
      - canbus.send:
          can_id: 0x7DF
          data: [0x02, 0x01, 0x0D, 0x00, 0x00, 0x00, 0x00, 0x00]
```

---

### 34. Modbus RTU Sensors

**You:** Read a Modbus energy meter

**What you get:**
```yaml
uart:
  tx_pin: GPIO17
  rx_pin: GPIO16
  baud_rate: 9600
  stop_bits: 1

modbus:
  id: modbus_hub

modbus_controller:
  - id: energy_meter
    address: 0x01
    modbus_id: modbus_hub
    update_interval: 5s

sensor:
  - platform: modbus_controller
    modbus_controller_id: energy_meter
    name: "Voltage"
    register_type: holding
    address: 0x0000
    unit_of_measurement: "V"
    value_type: U_WORD
    accuracy_decimals: 1
    filters:
      - multiply: 0.1
```

---

### 35. Custom Lambda Sensors

**You:** Create a sensor that calculates power from voltage and current

**What you get:**
```yaml
sensor:
  - platform: template
    name: "Calculated Power"
    lambda: |-
      float voltage = id(voltage_sensor).state;
      float current = id(current_sensor).state;
      if (isnan(voltage) || isnan(current)) {
        return NAN;
      }
      return voltage * current;
    unit_of_measurement: "W"
    update_interval: 5s
```

---

### 36. Home Assistant Services

**You:** Create custom services I can call from Home Assistant

**What you get:**
```yaml
api:
  services:
    - service: set_led_color
      variables:
        red: int
        green: int
        blue: int
      then:
        - light.turn_on:
            id: rgb_led
            red: !lambda "return red / 255.0;"
            green: !lambda "return green / 255.0;"
            blue: !lambda "return blue / 255.0;"

    - service: play_rtttl
      variables:
        song: string
      then:
        - rtttl.play: !lambda "return song;"
```

---

### 37. NFC Tag Reader

**You:** Add NFC tag reading for access control

**What you get:**
```yaml
pn532_spi:
  cs_pin: GPIO5
  update_interval: 1s

binary_sensor:
  - platform: pn532
    uid: XX-XX-XX-XX
    name: "NFC Tag 1"
    on_press:
      - switch.turn_on: door_lock
      - delay: 5s
      - switch.turn_off: door_lock

text_sensor:
  - platform: pn532
    name: "NFC Tag UID"
```

---

### 38. Nextion Display

**You:** Integrate a Nextion touch display

**What you get:**
```yaml
uart:
  tx_pin: GPIO17
  rx_pin: GPIO16
  baud_rate: 9600

display:
  - platform: nextion
    id: nextion_display
    update_interval: 5s
    lambda: |-
      it.set_component_text("temp", to_string(id(temperature).state).c_str());
      it.set_component_value("gauge", (int)(id(humidity).state));
```

---

### 39. Air Quality Monitor

**You:** Build an AirGradient-style air quality monitor

**What you get:**
- PM2.5 sensor (PMS5003)
- CO2 sensor (SenseAir S8)
- Temperature/humidity (SHT40)
- OLED display
- All sensors properly configured

---

### 40. Washing Machine Monitor

**You:** Monitor my washing machine using a vibration sensor

**What you get:**
```yaml
sensor:
  - platform: adc
    pin: GPIO34
    name: "Vibration"
    id: vibration
    update_interval: 1s

binary_sensor:
  - platform: template
    name: "Washing Machine Running"
    lambda: |-
      return id(vibration).state > 0.5;
    filters:
      - delayed_on: 30s
      - delayed_off: 2min
    on_release:
      - homeassistant.event:
          event: esphome.washing_done
```

---

## Troubleshooting Examples

### 41. WiFi Connection Issues

**You:** My ESPHome device won't connect to WiFi

**What you get:**
- Diagnostic checklist
- Signal strength testing config
- Fallback AP configuration
- Static IP configuration
- Hidden network setup

---

### 42. Sensor Returns NaN

**You:** My DHT22 sensor shows NaN instead of values

**What you get:**
- Wiring verification steps
- Pull-up resistor configuration
- Longer update intervals
- Debug logging setup

---

### 43. OTA Update Fails

**You:** OTA updates keep failing

**What you get:**
- Memory usage diagnostic config
- Timeout adjustment
- Large update workarounds
- USB fallback instructions

---

### 44. Boot Loop

**You:** My ESP32 keeps restarting

**What you get:**
- Power supply checks
- Strapping pin warnings
- Safe mode config
- Memory leak detection

---

### 45. Debug Lambda Errors

**You:** My lambda code has an error but I don't know where

**What you get:**
```yaml
logger:
  level: VERBOSE
  logs:
    component: DEBUG
    sensor: DEBUG

# Add logging to your lambda
sensor:
  - platform: template
    lambda: |-
      ESP_LOGD("custom", "Voltage: %f", id(voltage).state);
      ESP_LOGD("custom", "Current: %f", id(current).state);
      float result = id(voltage).state * id(current).state;
      ESP_LOGD("custom", "Result: %f", result);
      return result;
```

---

### 46. Compile Errors

**You:** ESPHome won't compile, shows "undefined reference"

**What you get:**
- Common library conflicts
- Platform version fixes
- Component compatibility checks

---

### 47. Slow Response

**You:** My device is slow to respond to Home Assistant

**What you get:**
- Update interval optimization
- Network diagnostics
- API buffer settings

---

### 48. Flash Memory Full

**You:** I get "out of program storage space" error

**What you get:**
- Board variant check
- Component trimming guide
- External logging options

---

### 49. Sensor Noise/Spikes

**You:** My sensor readings are very noisy

**What you get:**
```yaml
sensor:
  - platform: adc
    pin: GPIO34
    filters:
      - sliding_window_moving_average:
          window_size: 10
          send_every: 5
      - median:
          window_size: 5
      - delta: 0.1  # Only send if changed by 0.1
```

---

### 50. I2C Device Not Found

**You:** ESPHome can't find my I2C sensor

**What you get:**
- I2C scan config
- Address verification
- Pull-up configuration
- Speed adjustment

---

## Tips and Tricks

### Effective Communication

| Instead of... | Say... |
|---------------|--------|
| "I need help with ESPHome" | "Create an ESP32 config for a DHT22 on GPIO4" |
| "Fix my config" | "Fix this error: [paste actual error]" |
| "Make it work with Home Assistant" | "Add a custom service to control brightness from HA" |
| "It doesn't work" | "Sensor shows NaN - here's my config: [paste YAML]" |

### Iterative Building

1. Start simple: Get basic config working first
2. Add one component at a time
3. Test after each addition
4. Ask for troubleshooting if something breaks

### Using Templates

Say: "Show me the base-esp32.yaml template" to get a starting point, then customize.

### Getting Pin Recommendations

Say: "What GPIO should I use for [component] on ESP32?" for board-specific advice.

### External Components

Say: "Is there an external component for [device]?" to find community solutions.

---

## Reference

For detailed component documentation, see:

- [sensors.md](references/sensors.md) - 200+ sensor platforms
- [binary-sensors.md](references/binary-sensors.md) - PIR, touch, NFC
- [lights.md](references/lights.md) - LED strips, effects
- [displays.md](references/displays.md) - OLED, TFT, E-Paper
- [climate.md](references/climate.md) - Thermostat, PID
- [automations.md](references/automations.md) - Triggers, actions
- [troubleshooting.md](references/troubleshooting.md) - Common issues
