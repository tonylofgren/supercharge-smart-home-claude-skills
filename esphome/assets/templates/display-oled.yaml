# Generated by esphome@aurora-smart-home v1.0.0
# https://github.com/tonylofgren/aurora-smart-home
#
# ESPHome Template - OLED Display
# SSD1306 128x64 I2C OLED with sensor dashboard

substitutions:
  device_name: "oled-display"
  friendly_name: "OLED Display"

esphome:
  name: ${device_name}
  friendly_name: ${friendly_name}

esp32:
  board: esp32dev

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  ap:
    ssid: "${device_name}-fallback"

captive_portal:

api:
  encryption:
    key: !secret api_encryption_key

ota:
  - platform: esphome
    password: !secret ota_password

logger:

# I2C bus for OLED and sensors
i2c:
  sda: GPIO21
  scl: GPIO22
  scan: true

# Fonts
font:
  - file: "gfonts://Roboto"
    id: font_small
    size: 10
  - file: "gfonts://Roboto"
    id: font_medium
    size: 14
  - file: "gfonts://Roboto"
    id: font_large
    size: 24
  - file: "gfonts://Roboto@700"
    id: font_bold
    size: 16

# Time for clock display
time:
  - platform: homeassistant
    id: ha_time

# Example sensors (BME280)
sensor:
  - platform: bme280_i2c
    address: 0x76
    update_interval: 30s
    temperature:
      id: temp
      name: "Temperature"
    humidity:
      id: humidity
      name: "Humidity"
    pressure:
      id: pressure
      name: "Pressure"

  - platform: wifi_signal
    id: wifi_signal_db
    name: "WiFi Signal"
    update_interval: 60s
    entity_category: diagnostic

  - platform: uptime
    name: "Uptime"
    entity_category: diagnostic

# Page switching
globals:
  - id: display_page
    type: int
    initial_value: "0"

# Button to cycle pages
binary_sensor:
  - platform: gpio
    pin:
      number: GPIO0
      mode: INPUT_PULLUP
      inverted: true
    name: "Button"
    on_click:
      - lambda: |-
          id(display_page) = (id(display_page) + 1) % 3;

  - platform: status
    name: "Status"

# OLED Display
display:
  - platform: ssd1306_i2c
    id: oled
    model: "SSD1306 128x64"
    address: 0x3C
    update_interval: 1s
    lambda: |-
      // WiFi status icon (top right)
      if (WiFi.isConnected()) {
        it.printf(118, 0, id(font_small), "W");
      }

      switch (id(display_page)) {
        case 0:
          // Clock page
          if (id(ha_time).now().is_valid()) {
            it.strftime(64, 20, id(font_large), TextAlign::CENTER, "%H:%M", id(ha_time).now());
            it.strftime(64, 50, id(font_medium), TextAlign::CENTER, "%a %d %b", id(ha_time).now());
          } else {
            it.print(64, 32, id(font_medium), TextAlign::CENTER, "No time");
          }
          break;

        case 1:
          // Temperature & Humidity
          it.print(0, 0, id(font_bold), "Environment");
          it.printf(0, 20, id(font_medium), "Temp: %.1f C", id(temp).state);
          it.printf(0, 38, id(font_medium), "Hum:  %.0f %%", id(humidity).state);
          it.printf(0, 54, id(font_small), "Press: %.0f hPa", id(pressure).state);
          break;

        case 2:
          // System info
          it.print(0, 0, id(font_bold), "System");
          it.printf(0, 20, id(font_small), "WiFi: %.0f dBm", id(wifi_signal_db).state);
          it.printf(0, 35, id(font_small), "IP: %s", WiFi.localIP().toString().c_str());
          it.printf(0, 50, id(font_small), "Free: %d KB", ESP.getFreeHeap() / 1024);
          break;
      }

# Screen timeout (optional)
# interval:
#   - interval: 1min
#     then:
#       - lambda: |-
#           static uint32_t last_activity = millis();
#           if (millis() - last_activity > 300000) {  // 5 min
#             // Turn off display or dim
#           }

text_sensor:
  - platform: version
    name: "ESPHome Version"
    entity_category: diagnostic

button:
  - platform: restart
    name: "Restart"
    entity_category: config
