# Generated by esphome@aurora-smart-home v1.0.0
# https://github.com/tonylofgren/aurora-smart-home
#
# LED Strip with Effects Template
# WS2812/SK6812 with multiple effects

substitutions:
  device_name: "led-strip"
  friendly_name: "LED Strip"
  num_leds: "60"
  led_pin: "GPIO25"

esphome:
  name: ${device_name}
  friendly_name: ${friendly_name}

esp32:
  board: esp32dev

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  ap:
    ssid: "${device_name}-fallback"
    password: !secret wifi_ap_password

captive_portal:

api:
  encryption:
    key: !secret api_encryption_key

ota:
  platform: esphome
  password: !secret ota_password

logger:

light:
  - platform: esp32_rmt_led_strip
    pin: ${led_pin}
    num_leds: ${num_leds}
    rmt_channel: 0
    chipset: WS2812
    rgb_order: GRB
    name: "${friendly_name}"
    id: led_strip
    default_transition_length: 500ms
    effects:
      # Solid color effects
      - pulse:
          name: "Pulse"
          transition_length: 1s
          update_interval: 1s
          min_brightness: 20%
          max_brightness: 100%

      - strobe:
          name: "Strobe"
          colors:
            - state: true
              brightness: 100%
              duration: 50ms
            - state: false
              duration: 50ms

      - random:
          name: "Random"
          transition_length: 2s
          update_interval: 3s

      - flicker:
          name: "Candle"
          alpha: 95%
          intensity: 2%

      # Addressable effects
      - addressable_rainbow:
          name: "Rainbow"
          speed: 10
          width: 50

      - addressable_rainbow:
          name: "Fast Rainbow"
          speed: 25
          width: 30

      - addressable_color_wipe:
          name: "Color Wipe"
          colors:
            - red: 100%
              green: 0%
              blue: 0%
              num_leds: 1
            - red: 0%
              green: 0%
              blue: 0%
              num_leds: 1
          add_led_interval: 50ms
          reverse: false

      - addressable_scan:
          name: "Knight Rider"
          move_interval: 50ms
          scan_width: 5

      - addressable_twinkle:
          name: "Twinkle"
          twinkle_probability: 5%
          progress_interval: 4ms

      - addressable_random_twinkle:
          name: "Random Twinkle"
          twinkle_probability: 5%
          progress_interval: 32ms

      - addressable_fireworks:
          name: "Fireworks"
          update_interval: 32ms
          spark_probability: 10%
          use_random_color: true
          fade_out_rate: 120

      - addressable_flicker:
          name: "Addressable Flicker"
          update_interval: 16ms
          intensity: 5%

      # Custom fire effect
      - addressable_lambda:
          name: "Fire"
          update_interval: 15ms
          lambda: |-
            static uint8_t heat[${num_leds}];
            for (int i = 0; i < it.size(); i++) {
              heat[i] = qsub8(heat[i], random8(0, 55));
            }
            for (int k = it.size() - 1; k >= 2; k--) {
              heat[k] = (heat[k-1] + heat[k-2] + heat[k-2]) / 3;
            }
            if (random8() < 120) {
              int y = random8(7);
              heat[y] = qadd8(heat[y], random8(160, 255));
            }
            for (int j = 0; j < it.size(); j++) {
              uint8_t t192 = heat[j] * 191 / 255;
              uint8_t heatramp = t192 & 0x3F;
              heatramp <<= 2;
              if (t192 & 0x80) {
                it[j] = Color(255, 255, heatramp);
              } else if (t192 & 0x40) {
                it[j] = Color(255, heatramp, 0);
              } else {
                it[j] = Color(heatramp, 0, 0);
              }
            }

      # Ocean wave effect
      - addressable_lambda:
          name: "Ocean"
          update_interval: 50ms
          lambda: |-
            static float phase = 0;
            phase += 0.02;
            for (int i = 0; i < it.size(); i++) {
              float wave = sin(phase + i * 0.1);
              uint8_t b = 128 + 127 * wave;
              uint8_t g = 50 + 50 * wave;
              it[i] = Color(0, g, b);
            }

button:
  - platform: template
    name: "${friendly_name} All Off"
    on_press:
      - light.turn_off: led_strip

  - platform: restart
    name: "${friendly_name} Restart"
    entity_category: config

select:
  - platform: template
    name: "${friendly_name} Quick Color"
    id: quick_color
    options:
      - "Warm White"
      - "Cool White"
      - "Red"
      - "Green"
      - "Blue"
      - "Purple"
      - "Orange"
    optimistic: true
    on_value:
      - lambda: |-
          auto call = id(led_strip).turn_on();
          call.set_effect("None");
          if (x == "Warm White") {
            call.set_rgb(1.0, 0.8, 0.5);
          } else if (x == "Cool White") {
            call.set_rgb(0.9, 0.95, 1.0);
          } else if (x == "Red") {
            call.set_rgb(1.0, 0.0, 0.0);
          } else if (x == "Green") {
            call.set_rgb(0.0, 1.0, 0.0);
          } else if (x == "Blue") {
            call.set_rgb(0.0, 0.0, 1.0);
          } else if (x == "Purple") {
            call.set_rgb(0.5, 0.0, 1.0);
          } else if (x == "Orange") {
            call.set_rgb(1.0, 0.5, 0.0);
          }
          call.perform();
