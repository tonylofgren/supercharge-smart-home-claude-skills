# Motion-Activated Light Automation Template
# Generated by ha-yaml@aurora-smart-home v1.0.0
# https://github.com/tonylofgren/aurora-smart-home
#
# INSTRUCTIONS:
# 1. Replace entity IDs with your actual entities
# 2. Adjust timeout and brightness values as needed
# 3. Copy to your automations.yaml or create via UI

automation:
  - id: motion_light_ROOM_NAME
    alias: "Motion Light - ROOM_NAME"
    description: "Turn on light when motion detected, with time-based brightness"
    mode: restart  # Restart on new motion to reset timeout

    trigger:
      - platform: state
        entity_id: binary_sensor.ROOM_motion  # Replace with your motion sensor
        to: "on"
        id: motion_on

    condition:
      # Only when dark enough
      - condition: or
        conditions:
          - condition: sun
            after: sunset
            after_offset: "-00:30:00"
          - condition: numeric_state
            entity_id: sensor.ROOM_illuminance  # Replace or remove if no lux sensor
            below: 100

    action:
      # Turn on light with time-based brightness
      - service: light.turn_on
        target:
          entity_id: light.ROOM  # Replace with your light
        data:
          brightness_pct: >
            {% set hour = now().hour %}
            {% if hour < 6 or hour >= 23 %}
              20
            {% elif hour < 8 or hour >= 21 %}
              50
            {% else %}
              100
            {% endif %}
          transition: 1

      # Wait for motion to stop + timeout
      - wait_for_trigger:
          - platform: state
            entity_id: binary_sensor.ROOM_motion
            to: "off"
            for:
              minutes: 5  # Adjust timeout as needed
        timeout:
          minutes: 30  # Maximum on time

      # Turn off light
      - service: light.turn_off
        target:
          entity_id: light.ROOM
        data:
          transition: 3

# CUSTOMIZATION OPTIONS:
#
# 1. Add manual override detection:
#    Add this automation to pause motion control when light is manually adjusted
#
# 2. Multiple lights:
#    Change target to:
#      target:
#        entity_id:
#          - light.ROOM_ceiling
#          - light.ROOM_lamp
#
# 3. Different brightness for night:
#    Use input_number helper for configurable brightness
#
# 4. Disable during certain times:
#    Add input_boolean helper as condition check
