# Presence-Based Away Mode Automation Template
# Generated by ha-yaml@aurora-smart-home v1.0.0
# https://github.com/tonylofgren/aurora-smart-home
#
# INSTRUCTIONS:
# 1. Create a group.family with your person entities
# 2. Replace entity IDs with your actual entities
# 3. Adjust delay times as needed

# Required helper
input_select:
  home_mode:
    name: "Home Mode"
    options:
      - Home
      - Away
      - Night
      - Vacation
    icon: mdi:home

automation:
  # Everyone Left Home
  - id: presence_everyone_left
    alias: "Presence - Everyone Left Home"
    description: "Activate away mode when everyone leaves"
    trigger:
      - platform: state
        entity_id: group.family  # Replace with your group
        to: "not_home"
        for:
          minutes: 10  # Wait to confirm departure
    condition:
      - condition: state
        entity_id: input_select.home_mode
        state: "Home"
    action:
      - service: input_select.select_option
        target:
          entity_id: input_select.home_mode
        data:
          option: "Away"
      - service: script.turn_on
        target:
          entity_id: script.away_mode_actions

  # First Person Home
  - id: presence_first_home
    alias: "Presence - First Person Home"
    description: "Welcome home when first person arrives"
    trigger:
      - platform: state
        entity_id: group.family
        to: "home"
    condition:
      - condition: state
        entity_id: input_select.home_mode
        state:
          - "Away"
          - "Vacation"
    action:
      - service: input_select.select_option
        target:
          entity_id: input_select.home_mode
        data:
          option: "Home"
      - service: script.turn_on
        target:
          entity_id: script.welcome_home_actions

script:
  away_mode_actions:
    alias: "Away Mode Actions"
    sequence:
      # Turn off all lights
      - service: light.turn_off
        target:
          entity_id: all
      # Set climate to away temperature
      - service: climate.set_temperature
        target:
          entity_id: climate.YOUR_THERMOSTAT  # Replace
        data:
          temperature: 17  # Away temperature
      # Turn off media players
      - service: media_player.turn_off
        target:
          entity_id: all
      # Wait then arm alarm (optional)
      - delay:
          minutes: 5
      # - service: alarm_control_panel.alarm_arm_away
      #   target:
      #     entity_id: alarm_control_panel.home

  welcome_home_actions:
    alias: "Welcome Home Actions"
    sequence:
      # Disarm alarm (if using)
      # - service: alarm_control_panel.alarm_disarm
      #   target:
      #     entity_id: alarm_control_panel.home
      # Turn on entry lights if dark
      - condition: sun
        after: sunset
      - service: light.turn_on
        target:
          entity_id: light.hallway  # Replace with entry light
        data:
          brightness_pct: 100
      # Set climate to comfort temperature
      - service: climate.set_temperature
        target:
          entity_id: climate.YOUR_THERMOSTAT  # Replace
        data:
          temperature: 21  # Comfort temperature

# GROUP CONFIGURATION:
# Add this to groups.yaml or configuration.yaml
#
# group:
#   family:
#     name: "Family"
#     entities:
#       - person.john
#       - person.jane
