# Energy Dashboard Template
# Power monitoring, consumption tracking, and solar overview
#
# Customize entity_ids to match your setup
# Requires: mushroom cards (HACS), apexcharts-card (HACS) optional
#
# Generated by ha-yaml@aurora-smart-home
# https://github.com/tonylofgren/aurora-smart-home

title: Energy
icon: mdi:flash
path: energy
type: sections

sections:
  - type: grid
    title: Current Power
    cards:
      # Main power gauge
      - type: gauge
        entity: sensor.total_power
        name: Total Consumption
        min: 0
        max: 10000
        severity:
          green: 0
          yellow: 3000
          red: 6000
        unit: W
        needle: true

      # Power flow summary
      - type: custom:mushroom-entity-card
        entity: sensor.grid_power
        name: Grid Power
        icon: mdi:transmission-tower
        icon_color: |
          {% if states('sensor.grid_power') | float > 0 %}
            red
          {% else %}
            green
          {% endif %}

      - type: custom:mushroom-entity-card
        entity: sensor.solar_power
        name: Solar Production
        icon: mdi:solar-power
        icon_color: amber

      - type: custom:mushroom-entity-card
        entity: sensor.battery_power
        name: Battery
        icon: mdi:battery
        icon_color: blue

  - type: grid
    title: Today's Energy
    cards:
      - type: statistic
        entity: sensor.total_energy_daily
        name: Consumption
        stat_type: sum
        period:
          calendar:
            period: day

      - type: statistic
        entity: sensor.solar_energy_daily
        name: Solar Generation
        stat_type: sum
        period:
          calendar:
            period: day

      - type: statistic
        entity: sensor.grid_export_daily
        name: Grid Export
        stat_type: sum
        period:
          calendar:
            period: day

  - type: grid
    title: Major Consumers
    cards:
      - type: horizontal-stack
        cards:
          - type: custom:mushroom-entity-card
            entity: sensor.washing_machine_power
            name: Washer
            icon: mdi:washing-machine
            layout: vertical

          - type: custom:mushroom-entity-card
            entity: sensor.dryer_power
            name: Dryer
            icon: mdi:tumble-dryer
            layout: vertical

          - type: custom:mushroom-entity-card
            entity: sensor.dishwasher_power
            name: Dishwasher
            icon: mdi:dishwasher
            layout: vertical

          - type: custom:mushroom-entity-card
            entity: sensor.hvac_power
            name: HVAC
            icon: mdi:hvac
            layout: vertical

      - type: horizontal-stack
        cards:
          - type: custom:mushroom-entity-card
            entity: sensor.ev_charger_power
            name: EV Charger
            icon: mdi:ev-station
            layout: vertical

          - type: custom:mushroom-entity-card
            entity: sensor.water_heater_power
            name: Water Heater
            icon: mdi:water-boiler
            layout: vertical

          - type: custom:mushroom-entity-card
            entity: sensor.oven_power
            name: Oven
            icon: mdi:stove
            layout: vertical

          - type: custom:mushroom-entity-card
            entity: sensor.office_power
            name: Office
            icon: mdi:desktop-classic
            layout: vertical

  - type: grid
    title: Power History (24h)
    cards:
      - type: history-graph
        entities:
          - entity: sensor.total_power
            name: Total
          - entity: sensor.solar_power
            name: Solar
          - entity: sensor.grid_power
            name: Grid
        hours_to_show: 24
        refresh_interval: 60

  - type: grid
    title: Monthly Statistics
    cards:
      - type: statistic
        entity: sensor.total_energy_monthly
        name: Total Usage
        stat_type: sum
        period:
          calendar:
            period: month

      - type: statistic
        entity: sensor.solar_energy_monthly
        name: Solar Generated
        stat_type: sum
        period:
          calendar:
            period: month

      - type: entity
        entity: sensor.energy_cost_monthly
        name: Estimated Cost
        icon: mdi:currency-usd

  - type: grid
    title: Battery Status
    cards:
      - type: custom:mushroom-entity-card
        entity: sensor.battery_soc
        name: State of Charge
        icon: mdi:battery
        icon_color: |
          {% set soc = states('sensor.battery_soc') | int %}
          {% if soc > 80 %}green
          {% elif soc > 40 %}amber
          {% else %}red
          {% endif %}

      - type: custom:mushroom-entity-card
        entity: sensor.battery_power
        name: Power Flow
        icon: |
          {% if states('sensor.battery_power') | float > 0 %}
            mdi:battery-charging
          {% else %}
            mdi:battery-minus
          {% endif %}

      - type: custom:mushroom-entity-card
        entity: sensor.battery_cycles
        name: Cycle Count
        icon: mdi:battery-sync

  - type: grid
    title: Quick Controls
    cards:
      - type: custom:mushroom-chips-card
        chips:
          - type: action
            tap_action:
              action: call-service
              service: switch.turn_off
              target:
                entity_id:
                  - switch.non_essential_loads
            icon: mdi:lightning-bolt-circle
            content: Reduce Load

          - type: action
            tap_action:
              action: call-service
              service: input_select.select_option
              target:
                entity_id: input_select.ev_charging_mode
              data:
                option: solar_only
            icon: mdi:ev-station
            content: EV Solar Only

          - type: action
            tap_action:
              action: navigate
              navigation_path: /energy
            icon: mdi:chart-line
            content: HA Energy Dashboard
