# Room Package Template
# Generated by ha-yaml@aurora-smart-home v1.0.0
# https://github.com/tonylofgren/aurora-smart-home
#
# This package contains all entities, automations, and scripts
# for a single room. Copy and customize for each room.
#
# SETUP:
# 1. Enable packages in configuration.yaml:
#    homeassistant:
#      packages: !include_dir_named packages/
#
# 2. Create: config/packages/living_room.yaml (or room name)
# 3. Replace ROOM_NAME with actual room (e.g., living_room, bedroom)
# 4. Replace YOUR_ prefixes with actual entity IDs

# =====================================================
# INPUT HELPERS
# =====================================================

input_boolean:
  ROOM_NAME_automation_enabled:
    name: "ROOM_NAME Automation Enabled"
    icon: mdi:robot

  ROOM_NAME_occupied:
    name: "ROOM_NAME Occupied"
    icon: mdi:account

input_number:
  ROOM_NAME_brightness_day:
    name: "ROOM_NAME Daytime Brightness"
    min: 0
    max: 100
    step: 5
    unit_of_measurement: "%"
    icon: mdi:brightness-5
    initial: 100

  ROOM_NAME_brightness_night:
    name: "ROOM_NAME Nighttime Brightness"
    min: 0
    max: 100
    step: 5
    unit_of_measurement: "%"
    icon: mdi:brightness-3
    initial: 30

  ROOM_NAME_target_temperature:
    name: "ROOM_NAME Target Temperature"
    min: 16
    max: 26
    step: 0.5
    unit_of_measurement: "Â°C"
    icon: mdi:thermometer
    initial: 21

input_select:
  ROOM_NAME_scene:
    name: "ROOM_NAME Scene"
    options:
      - "Normal"
      - "Movie"
      - "Reading"
      - "Romantic"
      - "Night"
      - "Off"
    icon: mdi:palette

# =====================================================
# TEMPLATE SENSORS
# =====================================================

template:
  - sensor:
      # Room status summary
      - name: "ROOM_NAME Status"
        unique_id: ROOM_NAME_status
        state: >
          {% set motion = is_state('binary_sensor.YOUR_MOTION_SENSOR', 'on') %}
          {% set light = is_state('light.YOUR_ROOM_LIGHT', 'on') %}
          {% set occupied = is_state('input_boolean.ROOM_NAME_occupied', 'on') %}
          {% if motion %}
            Active
          {% elif occupied %}
            Occupied
          {% elif light %}
            Lights On
          {% else %}
            Empty
          {% endif %}
        icon: >
          {% set status = this.state %}
          {% if status == 'Active' %}
            mdi:motion-sensor
          {% elif status == 'Occupied' %}
            mdi:account
          {% elif status == 'Lights On' %}
            mdi:lightbulb-on
          {% else %}
            mdi:door
          {% endif %}

      # Comfort level
      - name: "ROOM_NAME Comfort"
        unique_id: ROOM_NAME_comfort
        state: >
          {% set temp = states('sensor.YOUR_TEMPERATURE_SENSOR') | float(20) %}
          {% set humidity = states('sensor.YOUR_HUMIDITY_SENSOR') | float(50) %}
          {% if temp < 18 %}
            Cold
          {% elif temp > 24 %}
            Warm
          {% elif humidity < 30 %}
            Dry
          {% elif humidity > 70 %}
            Humid
          {% else %}
            Comfortable
          {% endif %}

  - binary_sensor:
      # Occupancy based on multiple sensors
      - name: "ROOM_NAME Occupancy"
        unique_id: ROOM_NAME_occupancy
        device_class: occupancy
        state: >
          {{ is_state('binary_sensor.YOUR_MOTION_SENSOR', 'on')
             or is_state('binary_sensor.YOUR_PRESENCE_SENSOR', 'on')
             or is_state('input_boolean.ROOM_NAME_occupied', 'on') }}
        delay_off:
          minutes: 10

# =====================================================
# AUTOMATIONS
# =====================================================

automation:
  # Motion-activated lights
  - id: ROOM_NAME_motion_lights
    alias: "ROOM_NAME: Motion Lights"
    trigger:
      - platform: state
        entity_id: binary_sensor.YOUR_MOTION_SENSOR
        to: "on"
    condition:
      - condition: state
        entity_id: input_boolean.ROOM_NAME_automation_enabled
        state: "on"
      - condition: state
        entity_id: light.YOUR_ROOM_LIGHT
        state: "off"
    action:
      - service: light.turn_on
        target:
          entity_id: light.YOUR_ROOM_LIGHT
        data:
          brightness_pct: >
            {% set hour = now().hour %}
            {% if hour >= 8 and hour < 20 %}
              {{ states('input_number.ROOM_NAME_brightness_day') | int }}
            {% else %}
              {{ states('input_number.ROOM_NAME_brightness_night') | int }}
            {% endif %}
          transition: 2

  # Turn off lights when empty
  - id: ROOM_NAME_empty_lights_off
    alias: "ROOM_NAME: Empty - Lights Off"
    trigger:
      - platform: state
        entity_id: binary_sensor.ROOM_NAME_occupancy
        to: "off"
        for:
          minutes: 5
    condition:
      - condition: state
        entity_id: input_boolean.ROOM_NAME_automation_enabled
        state: "on"
    action:
      - service: light.turn_off
        target:
          entity_id: light.YOUR_ROOM_LIGHT
        data:
          transition: 5

  # Scene selector automation
  - id: ROOM_NAME_scene_changed
    alias: "ROOM_NAME: Scene Changed"
    trigger:
      - platform: state
        entity_id: input_select.ROOM_NAME_scene
    action:
      - choose:
          - conditions:
              - condition: state
                entity_id: input_select.ROOM_NAME_scene
                state: "Normal"
            sequence:
              - service: script.ROOM_NAME_scene_normal

          - conditions:
              - condition: state
                entity_id: input_select.ROOM_NAME_scene
                state: "Movie"
            sequence:
              - service: script.ROOM_NAME_scene_movie

          - conditions:
              - condition: state
                entity_id: input_select.ROOM_NAME_scene
                state: "Reading"
            sequence:
              - service: script.ROOM_NAME_scene_reading

          - conditions:
              - condition: state
                entity_id: input_select.ROOM_NAME_scene
                state: "Night"
            sequence:
              - service: script.ROOM_NAME_scene_night

          - conditions:
              - condition: state
                entity_id: input_select.ROOM_NAME_scene
                state: "Off"
            sequence:
              - service: light.turn_off
                target:
                  entity_id: light.YOUR_ROOM_LIGHT

  # Climate adjustment based on occupancy
  - id: ROOM_NAME_climate_occupied
    alias: "ROOM_NAME: Climate - Occupied"
    trigger:
      - platform: state
        entity_id: binary_sensor.ROOM_NAME_occupancy
        to: "on"
    condition:
      - condition: state
        entity_id: input_boolean.ROOM_NAME_automation_enabled
        state: "on"
    action:
      - service: climate.set_temperature
        target:
          entity_id: climate.YOUR_ROOM_CLIMATE
        data:
          temperature: "{{ states('input_number.ROOM_NAME_target_temperature') | float }}"

  # Climate setback when empty
  - id: ROOM_NAME_climate_empty
    alias: "ROOM_NAME: Climate - Empty"
    trigger:
      - platform: state
        entity_id: binary_sensor.ROOM_NAME_occupancy
        to: "off"
        for:
          minutes: 30
    condition:
      - condition: state
        entity_id: input_boolean.ROOM_NAME_automation_enabled
        state: "on"
    action:
      - service: climate.set_temperature
        target:
          entity_id: climate.YOUR_ROOM_CLIMATE
        data:
          temperature: "{{ (states('input_number.ROOM_NAME_target_temperature') | float) - 2 }}"

# =====================================================
# SCRIPTS / SCENES
# =====================================================

script:
  ROOM_NAME_scene_normal:
    alias: "ROOM_NAME: Normal Scene"
    sequence:
      - service: light.turn_on
        target:
          entity_id: light.YOUR_ROOM_LIGHT
        data:
          brightness_pct: 100
          kelvin: 4000
          transition: 2

  ROOM_NAME_scene_movie:
    alias: "ROOM_NAME: Movie Scene"
    sequence:
      - service: light.turn_on
        target:
          entity_id: light.YOUR_ROOM_LIGHT
        data:
          brightness_pct: 15
          kelvin: 2700
          transition: 3
      # Add TV backlight, close blinds, etc.

  ROOM_NAME_scene_reading:
    alias: "ROOM_NAME: Reading Scene"
    sequence:
      - service: light.turn_on
        target:
          entity_id: light.YOUR_ROOM_LIGHT
        data:
          brightness_pct: 80
          kelvin: 5000
          transition: 2

  ROOM_NAME_scene_night:
    alias: "ROOM_NAME: Night Scene"
    sequence:
      - service: light.turn_on
        target:
          entity_id: light.YOUR_ROOM_LIGHT
        data:
          brightness_pct: 5
          rgb_color: [255, 100, 50]
          transition: 3

  ROOM_NAME_toggle_automation:
    alias: "ROOM_NAME: Toggle Automation"
    sequence:
      - service: input_boolean.toggle
        target:
          entity_id: input_boolean.ROOM_NAME_automation_enabled

# =====================================================
# GROUPS (Optional)
# =====================================================

group:
  ROOM_NAME_lights:
    name: "ROOM_NAME Lights"
    entities:
      - light.YOUR_ROOM_LIGHT
      - light.YOUR_ROOM_LIGHT_2
      # Add more lights

  ROOM_NAME_sensors:
    name: "ROOM_NAME Sensors"
    entities:
      - sensor.YOUR_TEMPERATURE_SENSOR
      - sensor.YOUR_HUMIDITY_SENSOR
      - binary_sensor.YOUR_MOTION_SENSOR

# =====================================================
# CUSTOMIZE
# =====================================================

homeassistant:
  customize:
    light.YOUR_ROOM_LIGHT:
      friendly_name: "ROOM_NAME Main Light"

    binary_sensor.YOUR_MOTION_SENSOR:
      friendly_name: "ROOM_NAME Motion"

# =====================================================
# USAGE INSTRUCTIONS
# =====================================================
#
# 1. Copy this file to config/packages/[room_name].yaml
#
# 2. Find and replace:
#    - ROOM_NAME -> living_room (or your room, snake_case)
#    - YOUR_MOTION_SENSOR -> actual motion sensor entity
#    - YOUR_ROOM_LIGHT -> actual light entity
#    - YOUR_TEMPERATURE_SENSOR -> actual temp sensor
#    - YOUR_HUMIDITY_SENSOR -> actual humidity sensor
#    - YOUR_ROOM_CLIMATE -> actual climate entity
#
# 3. Remove any sections you don't need
#
# 4. Restart Home Assistant
#
# 5. Check for errors in Developer Tools > Logs
#
# TIPS:
# - Use consistent naming across all room packages
# - Add room-specific automations as needed
# - Extend scenes for your specific devices
# - Consider adding media player controls for relevant rooms
