# Actionable Notification Script Template
# Generated by ha-yaml@aurora-smart-home v1.0.0
# https://github.com/tonylofgren/aurora-smart-home
#
# This template provides reusable notification patterns with
# actionable buttons that trigger automations.

script:
  # Generic actionable notification
  send_actionable_notification:
    alias: "Send Actionable Notification"
    description: "Send notification with action buttons"
    fields:
      title:
        description: "Notification title"
        example: "Alert"
      message:
        description: "Notification message"
        example: "Something happened"
      action1_id:
        description: "First action identifier"
        example: "CONFIRM"
      action1_title:
        description: "First action button text"
        example: "Confirm"
      action2_id:
        description: "Second action identifier (optional)"
        example: "DISMISS"
      action2_title:
        description: "Second action button text (optional)"
        example: "Dismiss"
      target_device:
        description: "Target mobile device"
        example: "mobile_app_phone"
    sequence:
      - service: "notify.{{ target_device }}"
        data:
          title: "{{ title }}"
          message: "{{ message }}"
          data:
            actions:
              - action: "{{ action1_id }}"
                title: "{{ action1_title }}"
              - action: "{{ action2_id | default('DISMISS') }}"
                title: "{{ action2_title | default('Dismiss') }}"

  # Door left open notification
  door_left_open_alert:
    alias: "Door Left Open Alert"
    fields:
      door_name:
        description: "Name of the door"
        example: "Front Door"
    sequence:
      - service: notify.mobile_app_YOUR_PHONE  # Replace
        data:
          title: "Door Alert"
          message: "{{ door_name }} has been open for more than 10 minutes"
          data:
            tag: "door_{{ door_name | lower | replace(' ', '_') }}"
            actions:
              - action: "DISMISS_DOOR"
                title: "Dismiss"
              - action: "LOCK_DOOR"
                title: "Lock Door"
              - action: "REMIND_5MIN"
                title: "Remind in 5 min"

  # Garage door notification
  garage_door_notification:
    alias: "Garage Door Notification"
    sequence:
      - service: notify.mobile_app_YOUR_PHONE
        data:
          title: "Garage Door Open"
          message: "The garage door is open. Would you like to close it?"
          data:
            tag: "garage_door"
            actions:
              - action: "CLOSE_GARAGE"
                title: "Close"
              - action: "DISMISS_GARAGE"
                title: "Leave Open"

  # Security alert
  security_alert:
    alias: "Security Alert Notification"
    fields:
      sensor_name:
        description: "Name of the triggered sensor"
        example: "Back Door"
    sequence:
      - service: notify.mobile_app_YOUR_PHONE
        data:
          title: "Security Alert!"
          message: "Motion detected at {{ sensor_name }} while away"
          data:
            priority: high
            ttl: 0
            tag: "security_alert"
            actions:
              - action: "DISARM_ALARM"
                title: "Disarm"
              - action: "VIEW_CAMERA"
                title: "View Camera"
              - action: "CALL_EMERGENCY"
                title: "Call Security"

# Automations to handle action responses
automation:
  # Handle door alert actions
  - id: handle_door_actions
    alias: "Handle Door Alert Actions"
    trigger:
      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: "LOCK_DOOR"
      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: "REMIND_5MIN"
    action:
      - choose:
          - conditions:
              - condition: template
                value_template: "{{ trigger.event.data.action == 'LOCK_DOOR' }}"
            sequence:
              - service: lock.lock
                target:
                  entity_id: lock.front_door
              - service: notify.mobile_app_YOUR_PHONE
                data:
                  message: "Door locked"
                  data:
                    tag: "door_front_door"

          - conditions:
              - condition: template
                value_template: "{{ trigger.event.data.action == 'REMIND_5MIN' }}"
            sequence:
              - delay:
                  minutes: 5
              - condition: state
                entity_id: binary_sensor.front_door
                state: "on"
              - service: script.door_left_open_alert
                data:
                  door_name: "Front Door"

  # Handle garage door actions
  - id: handle_garage_actions
    alias: "Handle Garage Door Actions"
    trigger:
      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: "CLOSE_GARAGE"
    action:
      - service: cover.close_cover
        target:
          entity_id: cover.garage_door
      - service: notify.mobile_app_YOUR_PHONE
        data:
          message: "Garage door closing"
          data:
            tag: "garage_door"

  # Handle security actions
  - id: handle_security_actions
    alias: "Handle Security Alert Actions"
    trigger:
      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: "DISARM_ALARM"
      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: "VIEW_CAMERA"
    action:
      - choose:
          - conditions:
              - condition: template
                value_template: "{{ trigger.event.data.action == 'DISARM_ALARM' }}"
            sequence:
              - service: alarm_control_panel.alarm_disarm
                target:
                  entity_id: alarm_control_panel.home

          - conditions:
              - condition: template
                value_template: "{{ trigger.event.data.action == 'VIEW_CAMERA' }}"
            sequence:
              - service: notify.mobile_app_YOUR_PHONE
                data:
                  message: "Camera snapshot"
                  data:
                    image: "/api/camera_proxy/camera.front_door"

# USAGE EXAMPLES:
#
# Call the script from an automation:
# - service: script.send_actionable_notification
#   data:
#     title: "Laundry Done"
#     message: "The washing machine has finished"
#     action1_id: "ACKNOWLEDGE"
#     action1_title: "OK"
#     target_device: "mobile_app_your_phone"
