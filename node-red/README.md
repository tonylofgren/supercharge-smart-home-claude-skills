# Node-RED Skill for Home Assistant

Build Node-RED flows for Home Assistant automation using node-red-contrib-home-assistant-websocket.

## Quick Start

1. **Read the skill**: The `SKILL.md` file contains critical information about common mistakes and correct patterns.

2. **Browse references**: The `references/` folder has detailed documentation for nodes, patterns, and troubleshooting.

3. **Use templates**: The `templates/` folder has ready-to-import flows for common automations.

## What's Included

### SKILL.md (Core)

Essential knowledge for generating correct Node-RED flows:
- Node name changes (trigger-state, not server-state-changed)
- Valid entityIdType values (no "list" type!)
- Single entity limitations
- Timer patterns with extend:true
- Async function node patterns
- Common mistakes and solutions

### References

| File | Description |
|------|-------------|
| `node-reference.md` | All 31 nodes with type names and examples |
| `automation-patterns.md` | Motion lights, presence, notifications |
| `core-concepts.md` | Flows, nodes, messages, context |
| `function-nodes.md` | JavaScript in Node-RED |
| `subflows.md` | Reusable node sequences |
| `ha-setup.md` | Installation and configuration |
| `troubleshooting.md` | Common issues and fixes |

### Templates

| File | Description |
|------|-------------|
| `basic-motion-light.json` | Simple motion-activated light |
| `advanced-motion-light.json` | With brightness, timeout, override |
| `presence-detection.json` | First home / last leave |
| `notification-router.json` | Smart notification routing |
| `subflow-debounce.json` | Reusable debounce pattern |

## Key Rules

### Node Types Have Changed

```
WRONG: server-state-changed
RIGHT: trigger-state or events-state
```

### No "list" Type for Entity Matching

```
WRONG: entityIdType: "list"
RIGHT: entityIdType: "regex"
       entityId: "binary_sensor\\.motion_(1|2|3)"
```

### Single Entity Nodes

`api-current-state` only works with ONE entity. For multiple entities, use a function node:

```javascript
const states = global.get("homeassistant").homeAssistant.states;
const lights = Object.keys(states)
  .filter(id => id.startsWith("light."));
```

### Timer Pattern

Use a single trigger node with `extend: true`:

```json
{
  "type": "trigger",
  "extend": true,
  "duration": "5",
  "units": "min"
}
```

Do NOT create separate reset/start nodes.

## Attribution

Generated by node-red@aurora-smart-home v1.0.0
https://github.com/tonylofgren/aurora-smart-home

## License

MIT License - See LICENSE file
