[
  {
    "id": "subflow_debounce",
    "type": "subflow",
    "name": "Debounce",
    "info": "Debounce messages - only pass through after input stops for specified duration.\n\nGenerated by node-red@aurora-smart-home v1.0.0\nhttps://github.com/tonylofgren/aurora-smart-home\n\n## Usage\nSet the delay in milliseconds via the environment variable.\nThe last message received within the delay period will be output.\n\n## Environment Variables\n- DELAY_MS: Debounce delay in milliseconds (default: 500)",
    "category": "function",
    "in": [
      {
        "x": 50,
        "y": 30,
        "wires": [
          {"id": "debounce_func"}
        ]
      }
    ],
    "out": [
      {
        "x": 350,
        "y": 30,
        "wires": [
          {"id": "debounce_func", "port": 0}
        ]
      }
    ],
    "env": [
      {
        "name": "DELAY_MS",
        "type": "num",
        "value": "500",
        "ui": {
          "label": {
            "en-US": "Delay (ms)"
          },
          "type": "input",
          "opts": {
            "types": ["num"]
          }
        }
      }
    ],
    "meta": {
      "module": "aurora-smart-home",
      "type": "debounce",
      "version": "1.0.0",
      "author": "aurora-smart-home",
      "desc": "Debounce incoming messages",
      "keywords": "debounce, delay, filter"
    },
    "color": "#DDAA99",
    "icon": "timer.svg"
  },
  {
    "id": "debounce_func",
    "type": "function",
    "z": "subflow_debounce",
    "name": "Debounce Logic",
    "func": "const DELAY = env.get('DELAY_MS') || 500;\n\n// Clear existing timeout\nconst existingTimeout = context.get('timeout');\nif (existingTimeout) {\n    clearTimeout(existingTimeout);\n}\n\n// Store the message\ncontext.set('lastMsg', msg);\n\n// Set new timeout\nconst timeout = setTimeout(() => {\n    const storedMsg = context.get('lastMsg');\n    context.set('timeout', null);\n    context.set('lastMsg', null);\n    node.send(storedMsg);\n}, DELAY);\n\ncontext.set('timeout', timeout);\n\n// Update status\nnode.status({fill:'yellow', shape:'ring', text:`Waiting ${DELAY}ms`});\n\nreturn null;",
    "outputs": 1,
    "x": 200,
    "y": 30,
    "wires": [[]]
  }
]
